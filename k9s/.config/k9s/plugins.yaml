plugins:
  #--- Create debug container for selected pod in current namespace
  # See https://kubernetes.io/docs/tasks/debug/debug-application/debug-running-pod/#ephemeral-container
  debug:
    shortCut: Shift-D
    description: Add debug container
    dangerous: true
    scopes:
      # - pods # see if break
      - containers
    command: bash
    background: false
    confirm: true
    args:
      - -c
      - "kubectl debug -it --context $CONTEXT -n=$NAMESPACE $POD --target=$NAME --image=nicolaka/netshoot:v0.14 --profile=sysadmin --share-processes -- bash"

  netshoot-debug:
    shortCut: Shift-D
    confirm: false
    description: "kubectl debug netshoot (copy-to) current pod, then delete debug pod"
    scopes:
      - pods
    command: sh
    args:
      - -c
      - |
        set -e
        DEBUG_POD="${NAME}-debug"
        kubectl debug -n "$NAMESPACE" "$NAME" \
          --copy-to="${DEBUG_POD}" \
          -it --image=nicolaka/netshoot -- bash
        kubectl delete pod -n "$NAMESPACE" "${DEBUG_POD}" --wait=false

